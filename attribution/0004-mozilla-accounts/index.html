
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../0003-firefox-mobile/">
      
      
        <link rel="next" href="../0005-affiliate-marketing/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.19">
    
    
      
        <title>Mozilla accounts attribution - Bedrock Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-does-attribution-work" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Bedrock Documentation" class="md-header__button md-logo" aria-label="Bedrock Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Bedrock Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mozilla accounts attribution
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mozilla/bedrock" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mozilla/bedrock
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Bedrock Documentation" class="md-nav__button md-logo" aria-label="Bedrock Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Bedrock Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mozilla/bedrock" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mozilla/bedrock
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        Install
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../l10n/" class="md-nav__link">
        Localization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../coding/" class="md-nav__link">
        Developing on Bedrock
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">
        How to Contribute
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline/" class="md-nav__link">
        Continuous Integration & Deployment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../testing/" class="md-nav__link">
        Front-end testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../redirects/" class="md-nav__link">
        Managing redirects
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../newsletters/" class="md-nav__link">
        Newsletters
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../contentful/" class="md-nav__link">
        Contentful CMS Integration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../sitemap/" class="md-nav__link">
        Sitemaps
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../content-cards/" class="md-nav__link">
        Using External Content Card Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../banners/" class="md-nav__link">
        Banners
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../uitour/" class="md-nav__link">
        Mozilla.UITour
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../send-to-device/" class="md-nav__link">
        Send to Device widget
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../download-buttons/" class="md-nav__link">
        Firefox Download Buttons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../mozilla-accounts/" class="md-nav__link">
        Mozilla account helpers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../funnelcake/" class="md-nav__link">
        Funnel cakes and Partner Builds
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../abtest/" class="md-nav__link">
        A/B Testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../vpn-subscriptions/" class="md-nav__link">
        Mozilla VPN Subscriptions
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_21" checked>
      
      
      
        <label class="md-nav__link" for="__nav_21" id="__nav_21_label" tabindex="0">
          Attribution
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_21_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_21">
          <span class="md-nav__icon md-icon"></span>
          Attribution
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Attribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0001-analytics/" class="md-nav__link">
        Mozorg Analytics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0002-firefox-desktop/" class="md-nav__link">
        Firefox Desktop attribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0003-firefox-mobile/" class="md-nav__link">
        Firefox Mobile attribution
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Mozilla accounts attribution
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Mozilla accounts attribution
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-does-attribution-work" class="md-nav__link">
    How does attribution work?
  </a>
  
    <nav class="md-nav" aria-label="How does attribution work?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attribution-logic" class="md-nav__link">
    Attribution logic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attribution-referrer-cookie" class="md-nav__link">
    Attribution referrer cookie
  </a>
  
    <nav class="md-nav" aria-label="Attribution referrer cookie">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mozilla-vpn-referral-link-helper" class="md-nav__link">
    Mozilla VPN referral link helper
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow-metrics" class="md-nav__link">
    Flow metrics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#google-analytics-guidelines" class="md-nav__link">
    Google Analytics guidelines
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0005-affiliate-marketing/" class="md-nav__link">
        Mozilla CJMS Affiliate attribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0006-pocket-analytics/" class="md-nav__link">
        Pocket mode attribution
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_22" >
      
      
      
        <label class="md-nav__link" for="__nav_22" id="__nav_22_label" tabindex="0">
          Architectural Decision Records
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_22_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_22">
          <span class="md-nav__icon md-icon"></span>
          Architectural Decision Records
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architectural-decisions/" class="md-nav__link">
        Architectural Decision Records
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/0001-record-architecture-decisions/" class="md-nav__link">
        1. Record architecture decisions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/0002-move-ci-cd-pipelines-to-gitlab/" class="md-nav__link">
        2. Move CI/CD Pipelines to Gitlab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/0003-use-cloudflare-workers-and-convert-for-multi-variant-testing/" class="md-nav__link">
        3. Use Cloudflare Workers and Convert for multi-variant testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/0004-use-fluent-for-localization/" class="md-nav__link">
        4. Use Fluent For Localization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/0005-use-a-single-docker-image-for-all-deployments/" class="md-nav__link">
        5. Use a Single Docker Image For All Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/0006-revise-tooling-for-python-dependency-management/" class="md-nav__link">
        6. Revise tooling for Python dependency management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/0007-further-revise-tooling-for-python-dependency-management/" class="md-nav__link">
        7. Further revise tooling for Python dependency management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/0008-move-demos-to-gcp/" class="md-nav__link">
        8. Move Demos To GCP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/0009-use-manage-contentful-migrations/" class="md-nav__link">
        9. Manage Contentful schema state via migrations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/0010-move-ci-cd-to-github-actions/" class="md-nav__link">
        10. Move CI to Github Actions for Unit and Integration tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/0011-use-statsd-for-metrics-collection/" class="md-nav__link">
        11. Use StatsD for metrics collection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../browser-support/" class="md-nav__link">
        Browser Support
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-does-attribution-work" class="md-nav__link">
    How does attribution work?
  </a>
  
    <nav class="md-nav" aria-label="How does attribution work?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attribution-logic" class="md-nav__link">
    Attribution logic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attribution-referrer-cookie" class="md-nav__link">
    Attribution referrer cookie
  </a>
  
    <nav class="md-nav" aria-label="Attribution referrer cookie">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mozilla-vpn-referral-link-helper" class="md-nav__link">
    Mozilla VPN referral link helper
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow-metrics" class="md-nav__link">
    Flow metrics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#google-analytics-guidelines" class="md-nav__link">
    Google Analytics guidelines
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Mozilla accounts attribution</h1>

<p>For products such as Mozilla VPN, Relay, and Monitor, we use Mozilla
account as an authentication and subscription service. In addition to
Google Analytics for basic conversion tracking, we attribute web page
visits and clicks and through to actual subscriptions and installs by
passing a specific allow-list of known query parameters through to the
subscription platform. This is accomplished by adding referral data as
parameters to sign up links on product landing pages.</p>
<h2 id="how-does-attribution-work">How does attribution work?<a class="headerlink" href="#how-does-attribution-work" title="Permanent link">&para;</a></h2>
<p>When using any of the <a href="../../mozilla-accounts/">mozilla accounts helpers</a>
in bedrock, a default set of attribution parameters are
added to each account sign-in / subscription link on a product landing
page. Here's what we set for Mozilla VPN, as an example:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Example value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>utm_source</code></td>
<td>Query param identifying the referring site which sent the visitor.</td>
<td><code>www.mozilla.org-vpn-product-page</code></td>
</tr>
<tr>
<td><code>utm_medium</code></td>
<td>Query param identifying the type of link, such as referral, cost per click, or email.</td>
<td><code>referral</code></td>
</tr>
<tr>
<td><code>utm_campaign</code></td>
<td>Query param identifying the specific marketing campaign that was seen.</td>
<td><code>vpn-product-page</code></td>
</tr>
<tr>
<td><code>entrypoint</code></td>
<td>ID for which page of the website the request originates from (used for funnel analysis).</td>
<td><code>www.mozilla.org-vpn-product-page</code></td>
</tr>
<tr>
<td><code>device_id</code></td>
<td>ID that correlates to the active device being used (used for funnel analysis).</td>
<td>Alpha numeric string</td>
</tr>
<tr>
<td><code>flow_id</code></td>
<td>The flow identifier. A randomly-generated opaque ID (used for funnel analysis).</td>
<td>Alpha numeric string</td>
</tr>
<tr>
<td><code>flow_begin_time</code></td>
<td>The time at which a flow event occurred (used for funnel analysis).</td>
<td>Timestamp</td>
</tr>
<tr>
<td><code>service</code></td>
<td>Product ID used for data analysis in BigQuery (optional).</td>
<td>Alpha numeric string</td>
</tr>
</tbody>
</table>
<p>When performing data analysis, the default UTM values
above are what we equate to "direct" traffic (i.e. someone came to the
landing page directly then subscribed. They did not arrive from a
specific marketing campaign or other channel).</p>
<p>If we do detect that someone came from a marketing campaign or other
form of referral, then we have logic in place that will replace the
default UTM parameters on each link with more specific referral data, so
that we can attribute subscriptions to individual campaigns.</p>
<p>We also support passing several other optional referral parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Example value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>coupon</code></td>
<td>A coupon code that can be automatically applied at checkout (case sensitive).</td>
<td><code>VPN20</code></td>
</tr>
<tr>
<td><code>entrypoint_experiment</code></td>
<td>Experiment name ID.</td>
<td>Alpha numeric string</td>
</tr>
<tr>
<td><code>entrypoint_variation</code></td>
<td>Experiment variation ID</td>
<td>Alpha numeric string</td>
</tr>
</tbody>
</table>
<h3 id="attribution-logic">Attribution logic<a class="headerlink" href="#attribution-logic" title="Permanent link">&para;</a></h3>
<p>See the <a href="https://www.figma.com/file/etj3w6Sv2QLXIPH5rdTW4U/Firefox-Account-Referrals---Attribution-Flow?node-id=0%3A1&amp;t=OGAxLbRzT99Op8op-1">Application Logic Flow
Chart</a>
for a visual representation of the steps below (Mozilla access only).</p>
<ol>
<li>A website visitor loads a product landing page in their web browser.</li>
<li>A <a href="https://github.com/mozilla/bedrock/blob/main/media/js/base/fxa-attribution.es6.js">JavaScript
    function</a>
    then checks for and validates attribution data via a list of known
    URL parameters (see tables above).</li>
<li>If there are UTM parameters in the referral data, then those are
    used to replace the default values in each sign up link.
    Additionally if <code>coupon</code> or <code>entrypoint_experiment</code> params found,
    those are also appended.</li>
<li>If no UTM params exist, but there is a referrer cookie set, then the
    cookie value is used for <code>utm_campaign</code> and <code>utm_source</code> is set to
    <code>www.mozilla.org</code>. This cookie is often set when we display a "Get
    Mozilla VPN" promo on another mozorg page, such as <code>/whatsnew</code>.</li>
<li>If there's no referrer cookie, we next look at <code>document.referrer</code>
    to see if the visitor came from a search engine. If found, we set
    <code>utm_medium</code> as <code>organic</code> and <code>utm_source</code> as the search engine
    name.</li>
<li>Next, an <a href="https://github.com/mozilla/bedrock/blob/main/media/js/base/fxa-product-button.es6.js">metrics
    function</a>
    makes a flow API request to the Mozilla accounts authentication
    server. The request returns a series of metrics parameters that are
    used to track progress through the sign-up process. These "flow"
    parameters are also appended to each sign up link in addition to the
    existing attribution data.</li>
<li>When someone clicks through and completes the sign up process,
    attribution data we passed through is emitted as event logs. This
    data is then joined to a person's Mozilla account data during the
    Data Science team's ETL process (Extract, Transform, Load), where
    data is then brought together in Big Query.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>UTM parameters on sign up links will only be replaced if the page URL
contains both a valid <code>utm_source</code> and <code>utm_campaign</code> parameter. All
other UTM parameters are considered optional, but will still be passed
through, as long as the required parameters exist. This is to avoid
mixing referral data from different campaigns.</p>
</div>
<h2 id="attribution-referrer-cookie">Attribution referrer cookie<a class="headerlink" href="#attribution-referrer-cookie" title="Permanent link">&para;</a></h2>
<p>In situations where we want to try and track a visitor's first entry
point, say if someone lands on a <code>/whatsnew</code> page and then clicks on a
"Get Mozilla VPN" promo link, then we can set a referral cookie in
someone's browser when they click a same-site link (step 4 in the list
above).</p>
<p>The cookie can be set simply by adding the class name
<code>js-fxa-product-referral-link</code> to a same-site link, along with a
<code>data-referral-id</code> attribute. When clicked, our attribution logic will
use the value of <code>data-referral-id</code> to augment <code>utm_campaign</code> when
someone click through to the product page.</p>
<p>For example, a referral with <code>data-referral-id="navigation"</code> would
result in the following utm parameters being set on sign up links in the
product landing page:</p>
<ul>
<li><code>utm_source=www.mozilla.org</code>.</li>
<li><code>utm_campaign=navigation</code>.</li>
<li><code>utm_medium=referral</code>.</li>
</ul>
<h3 id="mozilla-vpn-referral-link-helper">Mozilla VPN referral link helper<a class="headerlink" href="#mozilla-vpn-referral-link-helper" title="Permanent link">&para;</a></h3>
<p>For Mozilla VPN, there's a <code>vpn_product_referral_link</code> helper built
specifically to help implement account referral links to the VPN landing
page:</p>
<div class="highlight"><pre><span></span><code><span class="cp">{{</span> <span class="nv">vpn_product_referral_link</span><span class="o">(</span>
    <span class="nv">referral_id</span><span class="o">=</span><span class="s1">&#39;navigation&#39;</span><span class="o">,</span>
    <span class="nv">link_to_pricing_page</span><span class="o">=</span><span class="kp">True</span><span class="o">,</span>
    <span class="nv">link_text</span><span class="o">=</span><span class="s1">&#39;Get Mozilla VPN&#39;</span><span class="o">,</span>
    <span class="nv">class_name</span><span class="o">=</span><span class="s1">&#39;mzp-t-secondary mzp-t-md&#39;</span><span class="o">,</span>
    <span class="nv">page_anchor</span><span class="o">=</span><span class="s1">&#39;#pricing&#39;</span><span class="o">,</span>
    <span class="nv">optional_attributes</span><span class="o">=</span> <span class="o">{</span>
        <span class="s1">&#39;data-cta-text&#39;</span> <span class="o">:</span> <span class="s1">&#39;Get Mozilla VPN&#39;</span><span class="o">,</span>
        <span class="s1">&#39;data-cta-type&#39;</span> <span class="o">:</span> <span class="s1">&#39;button&#39;</span><span class="o">,</span>
        <span class="s1">&#39;data-cta-position&#39;</span> <span class="o">:</span> <span class="s1">&#39;navigation&#39;</span><span class="o">,</span>
    <span class="o">}</span>
<span class="o">)</span> <span class="cp">}}</span>
</code></pre></div>
<p>The helper supports the following parameters:</p>
<table>
<thead>
<tr>
<th>Parameter name</th>
<th>Definition</th>
<th>Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>referral_id</code></td>
<td>The ID for the referring page / component. This serves as a value for ‘utm_campaign’.</td>
<td>String</td>
<td>‘navigation’</td>
</tr>
<tr>
<td><code>link_to_pricing_page</code></td>
<td>Link to the pricing page instead of the landing page (defaults to <code>False</code>).</td>
<td>Boolean</td>
<td>True</td>
</tr>
<tr>
<td><code>link_text</code></td>
<td>The link copy to be used in the call to action.</td>
<td>Localized string</td>
<td>‘Get Mozilla VPN’</td>
</tr>
<tr>
<td><code>class_name</code></td>
<td>A class name to be applied to the link (typically for styling with CSS).</td>
<td>String of one or more class names</td>
<td>‘mzp-t-secondary mzp-t-md’</td>
</tr>
<tr>
<td><code>page_anchor</code></td>
<td>An optional page anchor for the link destination.</td>
<td>String</td>
<td>‘#pricing’</td>
</tr>
<tr>
<td><code>optional_attributes</code></td>
<td>An dictionary of key value pairs containing additional data attributes to include in the button.</td>
<td>Dictionary</td>
<td>{‘data-cta-text’: ‘Get Mozilla VPN’, ‘data-cta-type’: ‘button’, ‘data-cta-position’: ‘navigation’}</td>
</tr>
</tbody>
</table>
<p>The cookie has the following configuration:</p>
<table>
<thead>
<tr>
<th>Cookie name</th>
<th>Value</th>
<th>Domain</th>
<th>Expiry</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fxa-product-referral-id</code></td>
<td>Campaign identifier</td>
<td><code>www.mozilla.org</code></td>
<td>1 hour</td>
</tr>
</tbody>
</table>
<h2 id="flow-metrics">Flow metrics<a class="headerlink" href="#flow-metrics" title="Permanent link">&para;</a></h2>
<p>Whilst UTM parameters are passed through to sign up links automatically
for any page of the website, in order for flow metrics to be added to
links, a specific JavaScript bundle needs to be manually run in the page
that requires it. The reason why it's separate is that depending on the
situation, flow metrics need to get queried and added at specific times
and conditions (more on that below).</p>
<p>To add flow metrics to links, a page's respective JavaScript bundle
should import and initialize the <code>FxaProductButton</code> script.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">FxaProductButton</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./path/to/fxa-product-button.es6.js&#39;</span><span class="p">;</span>

<span class="nx">FxaProductButton</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
</code></pre></div>
<p>The above JS is also available as a pre-compiled bundle, which can be
included directly in a template:</p>
<div class="highlight"><pre><span></span><code><span class="cp">{{</span> <span class="nv">js_bundle</span><span class="o">(</span><span class="s1">&#39;fxa_product_button&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</code></pre></div>
<p>When [init()]{.title-ref} is called, flow metrics will automatically be
added to add account sign up links on a page.</p>
<div class="admonition tip">
<p class="admonition-title">Important</p>
<p>Requests to metrics API endpoints should only be made when an associated
<abbr title="Call to Action">CTA</abbr> is visibly displayed on a page. For example, if a page contains both a Mozilla
accounts sign-up form and a Mozilla Monitor button, but only one <abbr title="Call to Action">CTA</abbr> is
displayed at any one time, then only the metrics request associated with
the visible <abbr title="Call to Action">CTA</abbr> should occur.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For links generated using the <code>fxa_link_fragment</code> helper, you will also
need to manually add a CSS class of <code>js-fxa-product-button</code> to trigger
the script.</p>
</div>
<h2 id="google-analytics-guidelines">Google Analytics guidelines<a class="headerlink" href="#google-analytics-guidelines" title="Permanent link">&para;</a></h2>
<p>For <abbr title="Google Tag Manager">GTM</abbr> <code>datalayer</code> attribute values in Mozilla account links, please use the
<a href="../0001-analytics/">analytics documentation</a>.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.top", "toc.follow"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>