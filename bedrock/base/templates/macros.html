{# This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/. -#}

{% macro mozorg_newsletter_form() %}
  {# Note: This form differs from the email_newsletter_form() that appears on most pages;
    The global form submits to bedrock, this one submits to sendto.mozilla.org #}
<aside>
  <form id="mozorg-newsletter-form" class="billboard footer-newsletter-form newsletter-form" method="post" action="https://sendto.mozilla.org/page/s/sign-up-for-mozilla">
    <h3>{{ _('Get Mozilla updates') }}</h3>

    <div class="form-contents">
      <div class="field field-email">
        <label for="id_email" class="visually-hidden">{{ _('Email') }}</label>
        <input name="email" type="email" id="id_email" value="" required aria-required="true" placeholder="{{ _('YOUR EMAIL HERE') }}">
      </div>

      <div id="form-details">
        <!-- This is bad, but a quick fix because we are pushing live in an hour -->
        <div class="field field-country">
          <label for="country" class="visually-hidden">{{ _('Country') }}</label>
          <select id="country" name="country">
            <option value=""></option>
            <option value="AF">Afghanistan</option>
            <option value="AL">Albania</option>
            <option value="DZ">Algeria</option>
            <option value="AS">American Samoa</option>
            <option value="AD">Andorra</option>
            <option value="AO">Angola</option>
            <option value="AI">Anguilla</option>
            <option value="AG">Antigua and Barbuda</option>
            <option value="AR">Argentina</option>
            <option value="AM">Armenia</option>
            <option value="AW">Aruba</option>
            <option value="AU">Australia</option>
            <option value="AT">Austria</option>
            <option value="AZ">Azerbaijan</option>
            <option value="BS">Bahamas</option>
            <option value="BH">Bahrain</option>
            <option value="BD">Bangladesh</option>
            <option value="BB">Barbados</option>
            <option value="BY">Belarus</option>
            <option value="BE">Belgium</option>
            <option value="BZ">Belize</option>
            <option value="BJ">Benin</option>
            <option value="BM">Bermuda</option>
            <option value="BT">Bhutan</option>
            <option value="BO">Bolivia</option>
            <option value="BA">Bosnia and Herzegovina</option>
            <option value="BW">Botswana</option>
            <option value="BR">Brazil</option>
            <option value="VG">British Virgin Islands</option>
            <option value="IO">British Indian Ocean Territory</option>
            <option value="BN">Brunei</option>
            <option value="BG">Bulgaria</option>
            <option value="BF">Burkina Faso</option>
            <option value="BI">Burundi</option>
            <option value="KH">Cambodia</option>
            <option value="CM">Cameroon</option>
            <option value="CA">Canada</option>
            <option value="CV">Cape Verde</option>
            <option value="KY">Cayman Islands</option>
            <option value="CF">Central African Republic</option>
            <option value="TD">Chad</option>
            <option value="CL">Chile</option>
            <option value="CN">China</option>
            <option value="CX">Christmas Island</option>
            <option value="CO">Colombia</option>
            <option value="KM">Comoros Islands</option>
            <option value="CD">Congo, Democratic Republic of the</option>
            <option value="CG">Congo, Republic of the</option>
            <option value="CK">Cook Islands</option>
            <option value="CR">Costa Rica</option>
            <option value="CI">Cote D'ivoire</option>
            <option value="HR">Croatia</option>
            <option value="CU">Cuba</option>
            <option value="CY">Cyprus</option>
            <option value="CZ">Czech Republic</option>
            <option value="DK">Denmark</option>
            <option value="DJ">Djibouti</option>
            <option value="DM">Dominica</option>
            <option value="DO">Dominican Republic</option>
            <option value="TP">East Timor</option>
            <option value="EC">Ecuador</option>
            <option value="EG">Egypt</option>
            <option value="SV">El Salvador</option>
            <option value="GQ">Equatorial Guinea</option>
            <option value="ER">Eritrea</option>
            <option value="EE">Estonia</option>
            <option value="ET">Ethiopia</option>
            <option value="FK">Falkland Islands (Malvinas)</option>
            <option value="FO">Faroe Islands</option>
            <option value="FJ">Fiji</option>
            <option value="FI">Finland</option>
            <option value="FR">France</option>
            <option value="GF">French Guiana</option>
            <option value="PF">French Polynesia</option>
            <option value="TF">French Southern Territories</option>
            <option value="GA">Gabon</option>
            <option value="GM">Gambia</option>
            <option value="GE">Georgia</option>
            <option value="DE">Germany</option>
            <option value="GH">Ghana</option>
            <option value="GI">Gibraltar</option>
            <option value="GR">Greece</option>
            <option value="GL">Greenland</option>
            <option value="GD">Grenada</option>
            <option value="GP">Guadeloupe</option>
            <option value="GU">Guam</option>
            <option value="GT">Guatemala</option>
            <option value="GN">Guinea</option>
            <option value="GW">Guinea-Bissau</option>
            <option value="GY">Guyana</option>
            <option value="HT">Haiti</option>
            <option value="VA">Holy See (Vatican City State)</option>
            <option value="HN">Honduras</option>
            <option value="HK">Hong Kong</option>
            <option value="HU">Hungary</option>
            <option value="IS">Iceland</option>
            <option value="IN">India</option>
            <option value="ID">Indonesia</option>
            <option value="IR">Iran</option>
            <option value="IQ">Iraq</option>
            <option value="IE">Ireland</option>
            <option value="IL">Israel</option>
            <option value="IT">Italy</option>
            <option value="JM">Jamaica</option>
            <option value="JP">Japan</option>
            <option value="JO">Jordan</option>
            <option value="KZ">Kazakhstan</option>
            <option value="KE">Kenya</option>
            <option value="KI">Kiribati</option>
            <option value="KR">South Korea</option>
            <option value="XK">Kosovo</option>
            <option value="KW">Kuwait</option>
            <option value="KG">Kyrgyzstan</option>
            <option value="LA">Laos</option>
            <option value="LV">Latvia</option>
            <option value="LB">Lebanon</option>
            <option value="LS">Lesotho</option>
            <option value="LR">Liberia</option>
            <option value="LI">Liechtenstein</option>
            <option value="LT">Lithuania</option>
            <option value="LU">Luxembourg</option>
            <option value="MO">Macau</option>
            <option value="MK">Macedonia</option>
            <option value="MG">Madagascar</option>
            <option value="MW">Malawi</option>
            <option value="MY">Malaysia</option>
            <option value="MV">Maldives</option>
            <option value="ML">Mali</option>
            <option value="MT">Malta</option>
            <option value="MH">Marshall Islands</option>
            <option value="MQ">Martinique</option>
            <option value="MR">Mauritania</option>
            <option value="MU">Mauritius</option>
            <option value="YT">Mayotte</option>
            <option value="MX">Mexico</option>
            <option value="FM">Micronesia</option>
            <option value="MD">Moldova, Republic of</option>
            <option value="MC">Monaco</option>
            <option value="MN">Mongolia</option>
            <option value="ME">Montenegro</option>
            <option value="MS">Montserrat</option>
            <option value="MA">Morocco</option>
            <option value="MZ">Mozambique</option>
            <option value="MM">Myanmar</option>
            <option value="NA">Namibia</option>
            <option value="NR">Nauru</option>
            <option value="NP">Nepal</option>
            <option value="NL">Netherlands</option>
            <option value="AN">Netherlands Antilles</option>
            <option value="NC">New Caledonia</option>
            <option value="NZ">New Zealand</option>
            <option value="NI">Nicaragua</option>
            <option value="NE">Niger</option>
            <option value="NG">Nigeria</option>
            <option value="NU">Niue</option>
            <option value="NF">Norfolk Island</option>
            <option value="MP">Northern Mariana Islands</option>
            <option value="NO">Norway</option>
            <option value="OM">Oman</option>
            <option value="PK">Pakistan</option>
            <option value="PW">Palau</option>
            <option value="PA">Panama</option>
            <option value="PG">Papua New Guinea</option>
            <option value="PY">Paraguay</option>
            <option value="PE">Peru</option>
            <option value="PH">Philippines</option>
            <option value="PN">Pitcairn Island</option>
            <option value="PL">Poland</option>
            <option value="PT">Portugal</option>
            <option value="PR">Puerto Rico</option>
            <option value="QA">Qatar</option>
            <option value="RE">Reunion</option>
            <option value="RO">Romania</option>
            <option value="RU">Russian Federation</option>
            <option value="RW">Rwanda</option>
            <option value="KN">Saint Kitts and Nevis</option>
            <option value="LC">Saint Lucia</option>
            <option value="VC">Saint Vincent and the Grenadines</option>
            <option value="WS">Samoa</option>
            <option value="SM">San Marino</option>
            <option value="ST">Sao Tome and Principe</option>
            <option value="SA">Saudi Arabia</option>
            <option value="SN">Senegal</option>
            <option value="RS">Serbia</option>
            <option value="SC">Seychelles</option>
            <option value="SL">Sierra Leone</option>
            <option value="SG">Singapore</option>
            <option value="SK">Slovakia</option>
            <option value="SI">Slovenia</option>
            <option value="SB">Solomon Islands</option>
            <option value="SO">Somalia</option>
            <option value="ZA">South Africa</option>
            <option value="ES">Spain</option>
            <option value="LK">Sri Lanka</option>
            <option value="SH">St. Helena</option>
            <option value="PM">St. Pierre and Miquelon</option>
            <option value="SD">Sudan</option>
            <option value="SR">Suriname</option>
            <option value="SZ">Swaziland</option>
            <option value="SE">Sweden</option>
            <option value="CH">Switzerland</option>
            <option value="SY">Syria</option>
            <option value="TW">Taiwan</option>
            <option value="TJ">Tajikistan</option>
            <option value="TZ">Tanzania</option>
            <option value="TH">Thailand</option>
            <option value="TG">Togo</option>
            <option value="TK">Tokelau</option>
            <option value="TO">Tonga</option>
            <option value="TT">Trinidad and Tobago</option>
            <option value="TN">Tunisia</option>
            <option value="TR">Turkey</option>
            <option value="TM">Turkmenistan</option>
            <option value="TC">Turks and Caicos Islands</option>
            <option value="TV">Tuvalu</option>
            <option value="UG">Uganda</option>
            <option value="UA">Ukraine</option>
            <option value="AE">United Arab Emirates</option>
            <option value="GB">United Kingdom</option>
            <option value="US" selected="selected">United States</option>
            <option value="UY">Uruguay</option>
            <option value="UZ">Uzbekistan</option>
            <option value="VU">Vanuatu</option>
            <option value="VE">Venezuela</option>
            <option value="VN">Viet Nam</option>
            <option value="VI">Virgin Islands (U.S.)</option>
            <option value="WF">Wallis and Futuna Islands</option>
            <option value="EH">Western Sahara</option>
            <option value="YE">Yemen</option>
            <option value="ZM">Zambia</option>
            <option value="ZW">Zimbabwe</option>
          </select>
        </div>

        <div class="field field-privacy">
          <label for="id_privacy" class="privacy-check-label">
            <input required aria-required="true" type="checkbox" name="custom-314" id="id_privacy" />
            <span class="title">{{ _('I’m okay with Mozilla handling my info as explained in <a href="%s">this Privacy Policy</a>')|format(url('privacy')) }}</span>
          </label>
        </div>
      </div>
    </div>

    <div class="form-submit">
      <input type="submit" id="footer_email_submit" value="{{ _('Sign me up') }} »" class="button">
      <p class="form-details"><small>{{ _('We will only send you Mozilla-related information.') }}</small></p>
    </div>
  </form>
</aside>
{% endmacro %}


{% macro facebook_share_url(url) -%}
  {{ 'https://www.facebook.com/sharer/sharer.php?u=%s'|format(url|urlencode)|e }}
{%- endmacro %}

{% macro twitter_share_url(url, tweet_text) -%}
  {{ 'https://www.twitter.com/intent/tweet?url=%s&text=%s'|format(url|urlencode, tweet_text|urlencode)|e }}
{%- endmacro %}

{% macro twitter_follow_button(account_name, account_id, show_account_id=True) -%}
  {%- if show_account_id -%}
    {% set label = _('Follow @%s')|format(account_id) %}
  {%- else -%}
    {% set label = _('Follow') %}
  {%- endif -%}
  <a href="https://twitter.com/{{ account_id }}" title="{{ _('Follow %s on Twitter')|format(account_name) }}" class="twitter-follow-button" data-social-network="twitter-only" data-social-action="Follow">{{ label }}</a>
{%- endmacro %}

{% macro twitter_timeline_widget(title='', heading_level=3, max_length=0) -%}
  {% if tweets -%}
    <section id="twitter-timeline-widget" itemscope itemtype="http://schema.org/Blog">
      <header>
        <h{{ heading_level }} itemprop="name">
          {%- if title -%}
            {{ title }}
          {%- else -%}
            {{ _('Twitter Timeline of %s')|format(tweets[0].user.name) }}
          {%- endif -%}
        </h{{ heading_level }}>
        <p>{{ twitter_follow_button(tweets[0].user.name, tweets[0].user.screen_name, False) }}</p>
      </header>
      <div class="tweets">
      {% for _tweet in tweets %}
        {%- if _tweet.retweeted_status -%}
          {% set retweet = true %}
          {% set tweet = _tweet.retweeted_status %}
        {%- else -%}
          {% set retweet = false %}
          {% set tweet = _tweet %}
        {%- endif -%}
        <article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          <header>
            <h{{ heading_level + 1 }} class="timestamp">
              <a href="https://twitter.com/{{ tweet.user.screen_name }}/status/{{ tweet.id }}" class="post" data-social-network="twitter-only" data-social-action="Post Link Exit">
                {{ format_tweet_timestamp(tweet)|safe }}
              </a>
            </h{{ heading_level + 1 }}>
            <div itemprop="author" itemscope itemtype="http://schema.org/Person">
              <a href="https://twitter.com/{{ tweet.user.screen_name }}" class="author" data-social-network="twitter-only" data-social-action="Author Link Exit">
                <img src="{{ tweet.user.profile_image_url_https }}" alt="" itemprop="image">
                <span itemprop="name">{{ tweet.user.name }}</span>
                <span itemprop="alternateName">@{{ tweet.user.screen_name }}</span>
              </a>
            </div>
          </header>
          <div>
            <p itemprop="articleBody">{{ format_tweet_body(tweet)|safe }}</p>
            {% if retweet -%}
              <p class="retweet-credit">{{ _('Retweeted by %s')|format('<a href="%s" class="credit" data-social-network="twitter-only" data-social-action="Retweet Credit Link Exit">%s</a>'|format('https://twitter.com/'+_tweet.user.screen_name, _tweet.user.name)|safe) }}</p>
            {% endif -%}
            {% if tweet.entities.media -%}
              {% for medium in tweet.entities.media -%}
                {% if medium.type == 'photo' -%}
                  <p class="media"><a href="{{ medium.expanded_url }}" class="image" data-social-network="twitter-only" data-social-action="Preview Image Exit"><img src="{{ medium.media_url_https }}" alt="" itemprop="image"></a></p>
                {% endif -%}
              {% endfor -%}
            {% endif -%}
          </div>
          <footer>
            <ul class="actions">
              <li><a class="reply" href="https://twitter.com/intent/tweet?in_reply_to={{ tweet.id }}" data-social-network="twitter-only" data-social-action="Reply">{{ _('Reply') }}</a></li>
              <li><a class="retweet" href="https://twitter.com/intent/retweet?tweet_id={{ tweet.id }}" data-social-network="twitter-only" data-social-action="Retweet">{{ _('Retweet') }}</a></li>
              <li><a class="favorite" href="https://twitter.com/intent/favorite?tweet_id={{ tweet.id }}" data-social-network="twitter-only" data-social-action="Favorite">{{ _('Favorite') }}</a></li>
            </ul>
          </footer>
        </article>
        {% if max_length > 0 and loop.index == max_length -%}
          {% break %}
        {% endif -%}
      {% endfor %}
      </div>
    {% endif -%}
  </section>
{%- endmacro %}

{% macro share_cta(cta_text, share_urls, share_text, id, class) %}
<aside class="mozilla-share-cta{% if class %} {{ class }}{% endif %}" tabindex="0"{% if id %} id="{{ id }}"{% endif -%}>
  <h3>{{ cta_text }}</h3>
  <ul>
    <li><a class="twitter" href="{{ 'https://www.twitter.com/intent/tweet?url=%s&text=%s'|format(share_urls.get('twitter')|urlencode, share_text|urlencode)|e }}" title="Twitter" data-button-type="social" data-social-network="Twitter">Twitter</a></li>
    <li><a class="facebook" href="{{ 'https://www.facebook.com/sharer/sharer.php?u=%s'|format(share_urls.get('facebook')|urlencode)|e }}" title="Facebook" data-button-type="social" data-social-network="Facebook">Facebook</a></li>
    <li><a class="g-plus" href="{{ 'https://plus.google.com/share?url=%s&hl=%s'|format(share_urls.get('googleplus')|urlencode, LANG)|e }}" title="Google+" data-button-type="social" data-social-network="Google+">Google+</a></li>
  </ul>
</aside>
{%- endmacro %}

{% macro anniversary_video(buttons_overlay, button_footer, embed_video) %}

{#
Usage:

Include the necessary .less files:
    'css/base/mozilla-share-cta.less',
    'css/base/firefox-anniversary-video.less',

Include the necessary .js files:
    'js/base/mozilla-share-cta.js',
    'js/base/firefox-anniversary-video.js',

Include this macro on the page:
    {% from "macros.html" import anniversary_video with context %}

Add the macro:
    {{ anniversary_video('play', 'share', True) }}

    First param: overlay buttons to show
        'play', 'replay',  'play-share',  'share-replay'
    Second param: footer button to show
        'share', 'download', 'none'
    Third param: include video embed
        True, False

See the .js file for API:
    js/base/firefox-anniversary-video.js
#}
{%
set video_locales = {
    'en-US': 'LtOGa5M8AuU',
    'de': 'q8r3HyMnZrQ',
    'fr': '-NYOc_aTzHo',
    'pt-BR': 'q7d7m_4X8tg'
}
%}

{%
set share_urls = {
    'twitter': 'http://mzl.la/fx10',
    'googleplus': 'https://www.mozilla.org/' + LANG + '/firefox/independent/?utm_source=Google&utm_medium=MozLandingPage&utm_campaign=FX10&utm_content=WebsiteShare',
    'facebook': 'https://www.mozilla.org/' + LANG + '/firefox/independent/?utm_source=Facebook&utm_medium=MozLandingPage&utm_campaign=FX10&utm_content=WebsiteShare#play'
}
%}

<section id="fx-anniversary-video-widget">
  <div id="fx-anniversary-video-wrapper">
    <div id="fx-anniversary-video-overlay">
      <div id="fx-anniversary-video-buttons" class="buttons {{ buttons_overlay }}" tabindex="1">
        {#
          This play <a> will be the only 'button' shown to non-JS users. JS adds
          role="button" and hijacks click.
        #}
        <a href="https://www.youtube.com/watch?v={{ video_locales.get(LANG, video_locales['en-US']) }}" rel="external" class="overlay-button-round button-play" ><span>{{ _('Watch the video') }}</span></a>

        <button type="button" class="overlay-button-round button-replay">{{ _('Replay the video') }}</button>

        <div class="button-group">
          <button type="button" class="overlay-button-rect button-play">{{ _('Watch the video') }}</button>

          {{ share_cta(_('Share the video'), share_urls, _('Keep the passion for a free and open Internet burning bright! #ChooseIndependent. Choose Firefox:')) }}

          <button type="button" class="overlay-button-rect button-replay">{{ _('Replay the video') }}</button>
        </div>{#-- /.button-group #}
      </div>{#-- /#fx-anniversary-video-buttons #}
    </div>{#-- /#fx-anniversary-video-overlay #}

    {% if embed_video %}
    <div id="fx-anniversary-video-embed-wrapper">
      <iframe id="fx-anniversary-video-embed" data-src="https://www.youtube.com/embed/{{ video_locales.get(LANG, video_locales['en-US']) }}?version=3&amp;enablejsapi=1&amp;wmode=transparent&amp;rel=0&amp;cc_lang_pref={{ LANG }}{% if not LANG in ['en-US', 'de', 'fr', 'pt-BR']%}&amp;cc_load_policy=1{% endif %}" frameborder="0" allowfullscreen></iframe>
    </div>
    {%- endif %}
  </div>{#-- /#fx-anniversary-video-wrapper #}
  <footer id="fx-anniversary-video-footer">
    <div id="fx-anniversary-video-footer-button" class="buttons {{ button_footer }}">
      {{ share_cta(_('Share the video'), share_urls, _('Keep the passion for a free and open Internet burning bright! #ChooseIndependent. Choose Firefox:')) }}
      <a href="{{ url('firefox.new') }}" class="download-link" data-button-type="download" data-interaction="download-click" data-download-version="platform">{{ _('Download Firefox') }}</a>
    </div>
  </footer>
</section>{#-- /#fx-anniversary-video-widget #}
{%- endmacro %}

{% macro fxfamilynav(activeprimary, activesub, navclass) %}
{#
1. Add to page:
  a. Include this macro:
    {% from "macros.html" import fxfamilynav with context %}

  b. Remove old site_header:

    {% block site_header %}{% endblock %}

  c. Add site_header_unwrapped block, including this macro and specifying the
    active primary and sub nav items:

    {% block site_header_unwrapped %}
      {{ fxfamilynav('android', 'index') }}
    {% endblock %}

    If you need the dark text version (like for /firefox/desktop), pass
    in the 'dark' argument:

    {% block site_header_unwrapped %}
      {{ fxfamilynav('desktop', 'index', dark') }}
    {% endblock %}

    Available primary/sub nav ID values:

    desktop
      - index
      - trust
      - customize
      - fast
      - sync
      - hello
    android
      - index
    os
      - index
      - devices
      - partners

    If you need a CTA in the sticky nav, call the macro and include
    the CTA element:

    {% block site_header_unwrapped %}
      {% call fxfamilynav('desktop', 'index') %}
        <a href="{{ url('firefox.new') }}">Download Firefox</a>
      {% endcall %}
    {% endblock %}


2. Make sure necessary files are in your CSS/JS bundles:
  a. CSS
    'css/firefox/family-nav.less'

  b. JS
    'js/libs/jquery.waypoints.min.js',
    'js/libs/jquery.waypoints-sticky.min.js',
    'js/firefox/family-nav.js',

  c. IE 9
    IE 9 requires the matchMedia.addListener polyfill. If your page doesn't
    already have a specific IE 9 bundle, you can use the generic one:

    <!--[if IE 9]>
    {% javascript 'matchmedia_addlistener' %}
    <![endif]-->



  ## Notes on CTA:

  CTA in sticky nav max dimensions are 160px w x 50px h. Anything over will be cut off.
  Conform or feel the wrath of chopped off edges.

  CTA is hidden in sticky nav at tablet (760px) breakpoint - just not enough
  room (this may change in the future).

  CTA is purposefully hidden for mobile.


  ## Notes on tabzilla wordmark

  By default, wordmark is transparent, which works for most pages. If you need to set
  the color behind the transparent wordmark, just include CSS like the following on
  your specific page:

  .fxfamilynav-tabzilla:before {
    background-color: #e840c0;
  }
#}

<header id="fxfamilynav-header" class="fxfamilynav-header{% if (navclass) %} {{ navclass }}{% endif %}">
  <div class="container">
    <a href="{{ url('firefox.family.index') }}"><i class="fxfamilynav-logo">{{ _('Firefox') }}</i></a>
    <nav id="fxfamilynav" class="fxfamilynav" role="navigation">
      <ul id="fxfamilynav-primary" class="primarynav">
        {# L10n: The <span> elements below are for visual formatting #}
        <li{% if activeprimary == 'desktop' %} class="active"{% endif %}>
          <a data-id="desktop" href="{{ url('firefox.desktop.index') }}" class="primary-link"><div>{{ _('<span>for</span> Desktop') }}</div></a>

          <ul class="subnav" id="desktop-subnav">
            <li{% if activesub in ('index', 'trust', 'customize', 'fast') %} class="hassubsubnav"{% endif %}>
              <a href="{{ url('firefox.desktop.index') }}"{% if activesub == 'index' %} class="selected"{% endif %}><div>{{ _('Overview') }}</div></a>

              {% if activesub in ('index', 'trust', 'customize', 'fast') %}
              <ul class="subsubnav" id="desktop-subsubnav">
                <li><a href="{{ url('firefox.desktop.trust') }}"{% if activesub == 'trust' %} class="selected"{% endif %}>{{ _('Trusted') }}</a></li>
                <li><a href="{{ url('firefox.desktop.customize') }}"{% if activesub == 'customize' %} class="selected"{% endif %}>{{ _('Flexible') }}</a></li>
                <li><a href="{{ url('firefox.desktop.fast') }}"{% if activesub == 'fast' %} class="selected"{% endif %}>{{ _('Fast') }}</a></li>
              </ul>
              {% endif %}
            </li>
            <li><a href="{{ url('firefox.sync') }}"{% if activesub == 'sync' %} class="selected"{% endif %}><div>{{ _('Sync') }}</div></a></li>
            <li><a href="{{ url('firefox.hello') }}"{% if activesub == 'hello' %} class="selected"{% endif %}><div>{{ _('Hello') }}</div></a></li>
          </ul>
        </li>
        <li{% if activeprimary == 'android' %} class="active"{% endif %}>
          <a data-id="android" href="{{ url('firefox.android.index') }}" class="primary-link"><div>{{ _('<span>for</span> Android') }}</div></a>

          <ul class="subnav" id="android-subnav">
            <li><a href="{{ url('firefox.android.index') }}"{% if activesub == 'index' %} class="selected"{% endif %}><div>{{ _('Overview') }}</div></a></li>
            <li><a href="{{ url('firefox.sync') }}"{% if activesub == 'sync' %} class="selected"{% endif %}><div>{{ _('Sync') }}</div></a></li>
          </ul>
        </li>
        <li{% if activeprimary == 'os' %} class="active"{% endif %}>
          <a data-id="os" href="{{ url('firefox.os.index') }}" class="primary-link"><div>{{ _('Firefox OS') }}</div></a>

          <ul class="subnav" id="os-subnav">
            <li><a data-id="os-index" href="{{ url('firefox.os.index') }}"{% if activesub == 'index' %} class="selected"{% endif %}><div>{{ _('Overview') }}</div></a></li>
            <li><a data-id="os-devices" href="{{ url('firefox.os.devices') }}"{% if activesub == 'devices' %} class="selected"{% endif %}><div>{{ _('Devices') }}</div></a></li>
            <li><a data-id="os-partners" href="{{ url('firefox.partners.index') }}"{% if activesub == 'partners' %} class="selected"{% endif %}><div>{{ _('For partners') }}</div></a></li>
            <li><a data-id="os-marketplace" rel="external" href="https://marketplace.firefox.com/"><div>{{ _('Marketplace') }}<i class="icon-external"></i></div></a></li>
          </ul>
        </li>
      </ul>
    </nav>{#-- /#fxfamillynav --#}

    <div id="fxfamilynav-tertiarynav" class="fxfamilynav-tertiarynav">
      {# the triangle needs a border, so :before content doesn't cut it #}
      <div class="triangle"></div>
      <div class="triangle-border"></div>

      <ul class="tertiarynav{% if activeprimary == 'desktop' %} active{% endif %}">
        <li><a href="{{ url('firefox.dnt') }}" data-ga="desktop - dnt">{{ _('Do Not Track') }}</a></li>
        <li><a href="{{ url('firefox.tiles') }}" data-ga="desktop - tiles">{{ _('Tiles') }}</a></li>
        <li><a href="{{ url('firefox.interest-dashboard') }}" data-ga="desktop - interest dashboard">{{ _('Interest Dashboard') }}</a></li>
        <li><a href="{{ url('firefox.developer') }}" data-ga="desktop - developer edition">{{ _('Developer Edition') }}</a></li>
        <li><a rel="external" href="https://support.mozilla.org/kb/private-browsing-browse-web-without-saving-info" data-ga="desktop - private browsing">{{ _('Private Browsing') }}</a></li>
        <li><a rel="external" href="https://addons.mozilla.org" data-ga="desktop - addons">{{ _('Add-ons') }}</a></li>
        <li><a rel="external" href="https://support.mozilla.org/products/firefox" data-ga="desktop - support">{{ _('Need help?') }}</a></li>
      </ul>

      <ul class="tertiarynav{% if activeprimary == 'android' %} active{% endif %}">
        <li><a href="{{ url('firefox.dnt') }}" data-ga="android - dnt">{{ _('Do Not Track') }}</a></li>
        <li><a rel="external" href="https://www.youtube.com/watch?v=Ewk0YtFTBec&amp;list=PLA8ABF6B7A66A0C5E&amp;index=15" data-ga="android - private browsing">{{ _('Private Browsing') }}</a></li>
        <li><a rel="external" href="https://addons.mozilla.org/android/" data-ga="android - addons">{{ _('Add-ons') }}</a></li>
        <li><a rel="external" href="https://support.mozilla.org/products/mobile" data-ga="android - support">{{ _('Need help?') }}</a></li>
      </ul>

      <ul class="tertiarynav{% if activeprimary == 'os' %} active{% endif %}">
        <li><a rel="external" href="https://blog.mozilla.org/blog/category/firefox-os/" data-ga="os - news">{{ _('News') }}</a></li>
        <li><a rel="external" href="https://developer.mozilla.org/Firefox_OS" data-ga="os - developers">{{ _('For developers') }}</a></li>
        <li><a rel="external" href="https://find.firefox.com" data-ga="os - find my device">{{ _('Find My Device') }}</a></li>
        <li><a rel="external" href="https://support.mozilla.org/products/firefox-os" data-ga="os - support">{{ _('Need help?') }}</a></li>
      </ul>
    </div>{#-- /#fxfamilynav-tertiarynav --#}

    {# Page will dictate CTA (button, usually) to be placed in this wrapper #}
    <div id="fxfamilynav-cta-wrapper" class="fxfamilynav-cta-wrapper">{% if caller %}{{ caller() }}{% endif %}</div>

    <button type="button" id="fxfamilynav-tertiarynav-trigger" class="fxfamilynav-tertiarynav-trigger" aria-controls="fxfamilynav-tertiarynav">
      <span>{{ _('Menu') }}</span>
      <div class="trigger-dots">
        <div class="trigger-dot"></div>
        <div class="trigger-dot"></div>
        <div class="trigger-dot"></div>
      </div>
    </button>

    <div id="tabzilla">
      <a href="{{ url('mozorg.home') }}">Mozilla</a>
    </div>
  </div>{#-- /.container --#}
</header>{#-- /#fxfamilynav-header --#}
{%- endmacro %}

{% macro send_to_device(platform, include_title=True, title_text='', include_logo=False) %}
  {% set ios_link = settings.APPLE_APPSTORE_FIREFOX_LINK %}
  {% set android_link = settings.GOOGLE_PLAY_FIREFOX_LINK %}
  <section id="send-to-device" class="{% if include_logo %}logo {% endif %}{% if include_title %}title{% else %}no-title{% endif %}">
    <div class="form-container">
      {% if include_title %}
        <h2 class="form-heading">
        {% if title_text %}
          {{ title_text }}
        {% else %}
          {{ _('Send Firefox to your smartphone or tablet') }}
        {% endif %}
        </h2>
      {% endif %}
      <h2 class="thank-you hidden">{{ _('Your download link was sent.') }}</h2>
      <form id="send-to-device-form" action="{{ secure_url('firefox.send-to-device-post') }}" method="post"{% if platform == 'select' %} class="dropdown"{% endif %}>
        <ul class="error-list hidden">
          <li class="sms">{{ _('Sorry. This number isn’t valid. Please enter a U.S. phone number.') }}</li>
          <li class="email">{{ _('Please enter an email address.') }}</li>
          <li class="platform">{{ _('Please make a selection before proceeding.') }}</li>
          <li class="system">{{ _('An error occurred in our system. Please try again later.') }}</li>
        </ul>
        <div class="input">
          <div class="platform-container">
            {% if platform == 'select' %}
            {# User selects OS they would like to receive link for. #}
              <label for="id-platform">
                {{ _('Select iOS or Android') }}
              </label>
              <select id="id-platform" name="platform" autocomplete="off" required>
                <option value="" selected>{{ _('Choose OS') }}</option>
                <option value="ios">iOS</option>
                <option value="android">Android</option>
              </select>
            {% else %}
              <input type="hidden" id="id-platform" name="platform" value="{{ platform }}">
            {% endif %}
            <input type="hidden" name="source-url" value="{{ secure_url() }}">
          </div>
          <div class="inline-field">
            <label id="form-input-label" for="id-input" data-alt="{{ _('Enter your email or 10-digit phone number') }}">{{ _('Enter your email') }}</label>
            <div class="form-input">
              <input id="id-input" name="phone-or-email" type="text" required>
            </div>
            <div class="form-submit">
              <button type="submit" class="button-flat">{{ _('Send') }}</button>
            </div>
          </div>
          <p class="legal sms">
            {{ _('SMS service available to U.S. phone numbers only. SMS &amp; data rates may apply.')}} {{ _('The intended recipient of the email or SMS must have consented.')}} <a href="{{ url('privacy.notices.websites') }}#campaigns" class="more">{{ _('Learn more')}}</a>
          </p>
          <p class="legal email">
            {{ _('The intended recipient of the email must have consented.')}} <a href="{{ url('privacy.notices.websites') }}#campaigns" class="more">{{ _('Learn more')}}</a>
          </p>
        </div>
        <div class="thank-you hidden">
          <p class="sms">{{ _('Check your device for the email or text message!') }}</p>
          <p class="email">{{ _('Check your device for the email!') }}</p>
          <a href="#" role="button" class="more send-another">{{ _('Send to another device') }}</a>
        </div>
        <div class="loading-spinner"></div>
      </form>
    </div>
    <footer>
      <ul class="{{ platform }}">
        <li class="app-store">
          <a class="more" href="{{ ios_link }}">{{ _('Go to the App Store')}}</a>
        </li>
        <li class="google-play">
          <a class="more" href="{{ android_link }}">{{ _('Go to Google Play')}}</a>
        </li>
      </ul>
    </footer>
  </section>
{%- endmacro %}
