{% extends 'newsletter/base.html' %}

{# Template used for a user to manage their subscriptions #}

{% block body_id %}newsletter-existing{% endblock body_id %}

{% block content %}
  <!-- Begin content -->

  {% block main_feature %}
    <div id="main-feature">
      <h1>{{ _('Manage your <span>Newsletter Subscriptions</span>') }}</h1>
    </div>
  {% endblock %}

  {% if formset %}
    <form method="post" action="{{ secure_url() }}" id="existing-newsletter-form" class="container billboard"
        data-initial-newsletters='{{ newsletters_subscribed }}'>
      {{ formset.management_form }}

      <div id="basic-settings">

        {% block intro %}{% endblock %}

        {% if form.non_field_errors() %}
          <div class="errorlist">
            {{ form.non_field_errors() }}
          </div>
        {% endif %}

        {% set email = form['email'] %}
        <div class="field email-field{% if email.errors %} field-error{% endif %}">
          {{ form.email.label_tag(_('Your email address:')) }}
          <div class="field-contents">
            {{ email }}
          </div>
          {{ email.errors }}
        </div>
        {% if email_change_pending %}
          <div class="field">
            {% trans new_email=email_change_pending %}
              An address change to {{ new_email }} is waiting to be confirmed.
              Check your email for the confirmation message, or change the email
              address above again to send a new confirmation message.
            {% endtrans %}
          </div>
        {% endif %}

        {% set country = form['country'] %}
        <div class="field country-field {% if country.errors %}field-error{% endif %}">
          {{ form.country.label_tag(_('Country:')) }}
          <div class="field-contents">
            {{ country }}
          </div>
          {{ country.errors }}
        </div>

        {% set lang = form['lang'] %}
        <div class="field lang-field {% if lang.errors %}field-error{% endif %}">
          {{ form.lang.label_tag(_('Language:')) }}
          <div class="field-contents">
            {{ lang }}
          </div>
          {{ lang.errors }}
        </div>

        <div class="field format-field">
          {{ form.format.label_tag(_('Format:')) }}
          <div class="field-contents field-radios">
            {{ form['format'] }}
          </div>
          {{ form['format'].errors }}
        </div>
      </div><!-- close #basic-settings -->

      <div class="field" id="other-newsletters">
        <div class="field-radios">
        <table class="table">
          <thead>
          <tr>
            <th></th>
            <th>{{ _('Subscribe') }}</th>
            <th>{{ _('Unsubscribe') }}</th>
          </tr>
          </thead>
          <tbody>
          {% for formpart in formset %}  {# each newsletter is a formset #}
            <tr class="subscription">
              <th>
                <h4 class="title">
                  {{ formpart.initial['title'] }}
                  {% if formpart.initial['english_only'] %}
                    <span class="en-only">({{ _('English&nbsp;only') }})</span>
                  {% endif %}
                </h4>
                {# hidden field: #}
                {{ formpart.newsletter }}
                <p class="description">
                  {# Note: the newsletter description is translated in the code, so
                     does not need to be translated again here. #}
                  {{ formpart.initial['description'] }}
                </p>
              </th>
              {{ formpart.subscribed }}
            </tr>
          {% endfor %}
          </tbody>
        </table>
        </div>
      </div><!-- close #all-newsletters -->

      <div class="field" id="remove-all-section">
        {{ form['remove_all'] }}
        {{ form.remove_all.label_tag(_('Remove me from all Mozilla emails')) }}
      </div>

      <div class="field submit-field">
        <input type="submit" value="{{ _('Save Preferences') }}" class="button">
      </div><!-- close .submit-field -->

    </form>
  {% endif %}
  <!-- End content -->
{% endblock %}

{% block js %}
  {{ js('existing') }}
{% endblock js %}
