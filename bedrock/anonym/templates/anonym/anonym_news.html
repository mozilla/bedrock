{#
 This Source Code Form is subject to the terms of the Mozilla Public
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at https://mozilla.org/MPL/2.0/.
#}

{% extends "base-protocol-mozilla.html" %}

{% block page_title %}Mozilla Anonym News{% endblock %}
{% block page_desc %}Mozilla Anonym News{% endblock %}
{% block body_class %}{{ super() }} anonym{% endblock %}

{% block page_css %}
  {{ css_bundle('mozilla-anonym') }}
{% endblock %}

{% block js %}
  {{ super() }}
  {{ js_bundle('anonym') }}
{% endblock %}

{% block site_header %}

    {% include 'anonym/includes/navigation.html' %}

{% endblock %}

{% block content %}
  <main id="mzan-main">
    <section class="mzan-news-section">
      <hgroup class="mzan-hgroup">
        <h1 class="mzan-heading">News</h1>
      </hgroup>

    {% set news_items = page.get_children().live().order_by('-first_published_at') %}

    {% if news_items %}
      {% set first_item = news_items.first().specific %}
      {% set has_featured = first_item and first_item.image %}

      {# Featured Item (if first item has an image) #}
      {% if has_featured %}
        {% set item_url = first_item.link if first_item.link else first_item.url %}
        <article class="mzan-news-featured add-full-width-borders">
          <div class="mzan-news-featured-content">
            <div class="mzan-news-source">
                {% if first_item.logo %}
                  <span class="mzan-news-logo">
                    <img class="mzan-card-logo" src="{{ first_item.logo.file.url }}" alt="{{ first_item.logo.title }}" loading="lazy" />
                  </span>
                {% endif %}
                  <a href="{{ item_url }}" class="mzan-news-external-linksss" aria-label="External link">
                    {% if first_item.link %}
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path d="M7 17L17 7M17 7H7M17 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    {% else %}
                    <span class="sr-only">Read more</span>
                    {% endif %}
                  </a>

              </div>
            <h2 class="mzan-heading">
              {{ first_item.title }}
            </h2>
            <div class="mzan-news-meta">
              {% if first_item.category %}
                <span class="mzan-news-category">{{ first_item.category }}</span>
              {% endif %}
              <span class="mzan-news-date">
                {{ first_item.first_published_at|date("M d") }}
              </span>
            </div>
          </div>
          <div class="mzan-news-featured-image">
            <img src="{{ first_item.image.file.url }}" alt="{{ first_item.image.title }}">
          </div>
        </article>
      {% endif %}

      {# News Grid #}
      {% set grid_items = news_items[1:] if has_featured else news_items %}
      {% if grid_items %}
        <div class="mzan-cards dividers add-full-width-borders">
          <div class="mzan-card-list is-three-wide will-wrap">
          {% for page_item in grid_items %}
            {% set item = page_item.specific %}
            {% set item_url = item.link if item.link else item.url %}
            <article class="mzan-card news-card">
              <div class="mzan-news-source">
                {% if item.logo %}
                  <div class="mzan-card-logo-wrap">
                    <img class="mzan-card-logo" src="{{ item.logo.file.url }}" alt="{{ item.logo.title }}" loading="lazy" />
                  </div>
                {% endif %}
                  <a href="{{ item_url }}" class="mzan-news-external-link" aria-label="External link">
                    {% if item.link %}
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path d="M7 17L17 7M17 7H7M17 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    {% else %}
                    <span class="sr-only">Read more</span>
                    {% endif %}
                  </a>

              </div>
              <h3 class="mzan-card-heading">
                {{ item.title }}
              </h3>

              <div class="mzan-card-light">
                {% if item.description %}
                <p>{{ item.description }}</p>
                {% endif %}
                <p class="mzan-news-meta">
                  {% if item.category %}
                    <span class="mzan-news-category">{{ item.category }}</span>
                  {% endif %}
                  <span class="mzan-news-date">{{ item.first_published_at|date("M d") }}</span>
                </p>
              </div>
            </article>
          {% endfor %}
        </div>
        </div>
      {% endif %}
    {% endif %}

    {# View All Posts Button - can be enabled later if needed #}
    {# <div class="mzan-news-view-all">
      <a href="#" class="mzan-button mzan-button-outline">View all posts</a>
    </div> #}

  </section>
  </main>
{% endblock %}
