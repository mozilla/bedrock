{#
 This Source Code Form is subject to the terms of the Mozilla Public
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at https://mozilla.org/MPL/2.0/.
#}

{% extends "base-protocol-mozilla.html" %}

{% block page_title %}Mozilla Anonym News{% endblock %}
{% block page_desc %}Mozilla Anonym News{% endblock %}
{% block body_class %}mzan{% endblock %}

{% block page_css %}
  {{ css_bundle('mozilla-anonym') }}
{% endblock %}

{% block site_header %}
  {% include 'anonym/includes/navigation.html' %}
{% endblock %}

{% block content %}
  <main id="mzan-main">
    <h1>News</h1>

    {% set news_items = page.get_children().live().order_by('-first_published_at') %}

    {% if news_items %}
      {% set first_item = news_items.first().specific %}
      {% set has_featured = first_item and first_item.image %}

      {# Featured Item (if first item has an image) #}
      {% if has_featured %}
        {% set item_url = first_item.link if first_item.link else first_item.url %}
        <article class="mzan-news-featured">
          <div class="mzan-news-featured-content">
            <div class="mzan-news-source">
              {% if first_item.logo %}
                <span class="mzan-news-logo">
                  <img src="{{ first_item.logo.file.url }}" alt="{{ first_item.logo.title }}" width="40" height="40">
                </span>
              {% endif %}
              {% if first_item.link %}
                <a href="{{ first_item.link }}" class="mzan-news-external-link" aria-label="External link">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M7 17L17 7M17 7H7M17 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </a>
              {% endif %}
            </div>
            <h2>
              <a href="{{ item_url }}">{{ first_item.title }}</a>
            </h2>
            {% if first_item.description %}
              <p>{{ first_item.description }}</p>
            {% endif %}
            <div class="mzan-news-meta">
              {% if first_item.category %}
                <span class="mzan-news-category">{{ first_item.category }}</span>
              {% endif %}
              <span class="mzan-news-date">{{ first_item.first_published_at|date("M d, Y") }}</span>
            </div>
          </div>
          <div class="mzan-news-featured-image">
            <img src="{{ first_item.image.file.url }}" alt="{{ first_item.image.title }}">
          </div>
        </article>
      {% endif %}

      {# News Grid #}
      {% set grid_items = news_items[1:] if has_featured else news_items %}
      {% if grid_items %}
        <div class="mzan-news-grid">
          {% for page_item in grid_items %}
            {% set item = page_item.specific %}
            {% set item_url = item.link if item.link else item.url %}
            <article class="mzan-news-card">
              <div class="mzan-news-source">
                {% if item.logo %}
                  <span class="mzan-news-logo">
                    <img src="{{ item.logo.file.url }}" alt="{{ item.logo.title }}" width="40" height="40">
                  </span>
                {% endif %}
                {% if item.link %}
                  <a href="{{ item.link }}" class="mzan-news-external-link" aria-label="External link">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path d="M7 17L17 7M17 7H7M17 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </a>
                {% endif %}
              </div>
              <h3>
                <a href="{{ item_url }}">{{ item.title }}</a>
              </h3>
              {% if item.description %}
                <p>{{ item.description }}</p>
              {% endif %}
              <div class="mzan-news-meta">
                {% if item.category %}
                  <span class="mzan-news-category">{{ item.category }}</span>
                {% endif %}
                <span class="mzan-news-date">{{ item.first_published_at|date("M d, Y") }}</span>
              </div>
            </article>
          {% endfor %}
        </div>
      {% endif %}
    {% endif %}

    {# View All Posts Button - can be enabled later if needed #}
    {# <div class="mzan-news-view-all">
      <a href="#" class="mzan-button mzan-button-outline">View all posts</a>
    </div> #}
  </main>
{% endblock %}
